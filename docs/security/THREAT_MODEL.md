# STRIDE Threat Model

## 1. Introduction

This document contains a comprehensive threat analysis of the Secure E2EE Messaging System using the **STRIDE** methodology.

**STRIDE** stands for:
- **S**poofing
- **T**ampering
- **R**epudiation
- **I**nformation Disclosure
- **D**enial of Service
- **E**levation of Privilege

---

## 2. System Components

### 2.1 Component List

1. **Client Browser**
   - React UI
   - Web Crypto API
   - IndexedDB (key storage)

2. **Network Communication**
   - HTTPS connections
   - WebSocket connections

3. **Server**
   - Authentication API
   - Message relay
   - File storage
   - Logging system

4. **Database**
   - User credentials
   - Encrypted messages
   - Encrypted files
   - Security logs

5. **Key Exchange Protocol**
   - ECDH computation
   - Digital signatures
   - Session key derivation

---

## 3. Data Flow Diagram

```
┌──────────────┐
│   Client A   │
│  (Browser)   │
└──────┬───────┘
       │
       │ (1) Login credentials
       │ (2) Encrypted messages
       │ (3) ECDH public keys + signatures
       │
       ▼
┌──────────────┐         ┌──────────────┐
│    Server    │◄───────►│   Database   │
│   (Node.js)  │         │  (MongoDB)   │
└──────┬───────┘         └──────────────┘
       │
       │ (4) Forwarded encrypted messages
       │ (5) ECDH public keys + signatures
       │
       ▼
┌──────────────┐
│   Client B   │
│  (Browser)   │
└──────────────┘
```

### Trust Boundaries

```
┌───────────────────────────────────────┐
│         TRUSTED (Client)              │
│  - Plaintext messages                 │
│  - Private keys                       │
│  - Decryption operations              │
└───────────────┬───────────────────────┘
                │
        ════════╪════════ (HTTPS)
                │
┌───────────────┴───────────────────────┐
│       UNTRUSTED (Server/Network)      │
│  - Ciphertext only                    │
│  - Public keys                        │
│  - Metadata                           │
└───────────────────────────────────────┘
```

---

## 4. STRIDE Analysis

### 4.1 User Authentication

| Threat Type | Specific Threat | Risk Level | Attack Scenario | Mitigation | Implementation Status |
|-------------|-----------------|------------|-----------------|------------|----------------------|
| **Spoofing** | Attacker guesses weak password | HIGH | Brute force attack on login | - Strong password requirements<br>- argon2 hashing (memory-hard)<br>- Rate limiting | ✅ Implemented |
| **Spoofing** | Attacker steals credentials | HIGH | Phishing, keylogger | - User education<br>- HTTPS only<br>- Consider 2FA (bonus) | ⚠️ Basic (HTTPS only) |
| **Spoofing** | Session hijacking | MEDIUM | Steal JWT token | - Short JWT expiration<br>- Secure cookie flags<br>- Token stored in httpOnly cookie | ⚠️ JWT in localStorage (acceptable for project) |
| **Tampering** | Modify password in transit | LOW | MITM on auth request | - HTTPS with proper certificate validation | ✅ Implemented |
| **Tampering** | SQL injection | N/A | Malicious input in username | - MongoDB (NoSQL)<br>- Input validation<br>- Parameterized queries | ✅ Implemented |
| **Repudiation** | User denies creating account | LOW | Dispute over account creation | - Logging with timestamps and IP | ✅ Implemented |
| **Info Disclosure** | Password database leaked | CRITICAL | Database breach | - Salted argon2 hashes<br>- No plaintext passwords<br>- Database access control | ✅ Implemented |
| **DoS** | Flood registration endpoint | MEDIUM | Mass account creation | - Rate limiting<br>- CAPTCHA (optional) | ⚠️ Basic rate limiting |
| **Elevation** | Normal user gains admin access | LOW | Privilege escalation | - No admin roles in current design<br>- Proper JWT validation | ✅ N/A (no admin) |

---

### 4.2 Key Generation & Storage

| Threat Type | Specific Threat | Risk Level | Attack Scenario | Mitigation | Implementation Status |
|-------------|-----------------|------------|-----------------|------------|----------------------|
| **Spoofing** | Fake key pair claimed as user's | MEDIUM | Replace public key during registration | - Signature verification in key exchange<br>- Public key tied to user ID | ✅ Implemented |
| **Tampering** | Modify stored private key | HIGH | Malware accesses IndexedDB | - Private key encrypted before storage<br>- Key derived from password<br>- Integrity checks on retrieval | ✅ Implemented |
| **Tampering** | Weak key generation | MEDIUM | Predictable random number generator | - Use Web Crypto API (cryptographically secure)<br>- Proper key sizes (P-256, RSA-2048+) | ✅ Implemented |
| **Repudiation** | User denies owning key pair | LOW | Claims key was not generated by them | - Key generation logged with timestamp | ✅ Implemented |
| **Info Disclosure** | Private key leaked | CRITICAL | Malware exports IndexedDB | - Private key encrypted at rest<br>- Require password to decrypt<br>- User education | ✅ Implemented |
| **Info Disclosure** | Private key sent to server | CRITICAL | Implementation error | - Code review<br>- Testing (verify server DB has no private keys)<br>- Never transmit private key | ✅ Verified (see testing docs) |
| **DoS** | Delete user's keys | MEDIUM | Malware clears IndexedDB | - No automatic backup (by design for security)<br>- Warn user about key loss | ⚠️ Warning only |
| **Elevation** | N/A | N/A | N/A | N/A | N/A |

---

### 4.3 Key Exchange Protocol

| Threat Type | Specific Threat | Risk Level | Attack Scenario | Mitigation | Implementation Status |
|-------------|-----------------|------------|-----------------|------------|----------------------|
| **Spoofing** | Man-in-the-Middle (MITM) | CRITICAL | Attacker intercepts and replaces ECDH public keys | - Digital signatures (ECDSA)<br>- Signature verification before key derivation<br>- Public key retrieved from trusted server | ✅ Implemented & Tested |
| **Spoofing** | Impersonate user | HIGH | Send fake key exchange message | - Signature tied to long-term key pair<br>- Cannot forge signature without private key | ✅ Implemented |
| **Tampering** | Modify ECDH public keys in transit | HIGH | MITM modifies messages | - Signatures cover all message fields<br>- Any modification invalidates signature | ✅ Implemented |
| **Tampering** | Downgrade attack | MEDIUM | Force use of weak crypto | - No algorithm negotiation (hardcoded strong algorithms)<br>- ECC P-256, AES-256-GCM only | ✅ Implemented |
| **Repudiation** | Deny initiating key exchange | LOW | User claims they didn't start conversation | - Key exchange logged<br>- Signatures provide non-repudiation | ✅ Implemented |
| **Info Disclosure** | Reveal session key | CRITICAL | Compromise ephemeral private keys | - Ephemeral keys deleted after derivation<br>- Forward secrecy (ECDH)<br>- Keys only in memory | ✅ Implemented |
| **Info Disclosure** | Traffic analysis | MEDIUM | Observe who talks to whom, when | - HTTPS hides some metadata<br>- Server knows sender/receiver (unavoidable) | ⚠️ Partial (server sees metadata) |
| **DoS** | Flood with key exchange requests | MEDIUM | Exhaust server/client resources | - Rate limiting on key exchange endpoint<br>- Require authentication before key exchange | ⚠️ Basic rate limiting |
| **Elevation** | N/A | N/A | N/A | N/A | N/A |

---

### 4.4 Message Encryption & Transmission

| Threat Type | Specific Threat | Risk Level | Attack Scenario | Mitigation | Implementation Status |
|-------------|-----------------|------------|-----------------|------------|----------------------|
| **Spoofing** | Send message as another user | HIGH | Forge sender ID | - JWT authentication<br>- Server validates sender ID matches JWT<br>- Signatures on messages | ✅ Implemented |
| **Tampering** | Modify encrypted message | HIGH | Flip bits in ciphertext | - AES-GCM authentication tag<br>- Tag verification on decryption<br>- Decryption fails if modified | ✅ Implemented |
| **Tampering** | Replay old message | MEDIUM | Capture and resend encrypted message | - Nonce (never reused)<br>- Timestamp (reject old messages)<br>- Sequence number (increasing)<br>- Client tracks seen nonces | ✅ Implemented & Tested |
| **Tampering** | Reorder messages | LOW | Deliver messages out of order | - Sequence numbers<br>- Client detects gaps | ✅ Implemented |
| **Repudiation** | Deny sending message | LOW | Claim "I didn't send that" | - Sender ID in message<br>- Logs on server<br>- (Note: E2EE makes forensics harder) | ⚠️ Partial (logs exist but E2EE limits proof) |
| **Info Disclosure** | Decrypt messages on server | CRITICAL | Malicious server admin | - End-to-end encryption<br>- Server has no session keys<br>- Only ciphertext stored | ✅ Implemented & Verified |
| **Info Disclosure** | Brute force AES key | THEORETICAL | Try all 2^256 keys | - AES-256 (infeasible to brute force)<br>- 256-bit key space | ✅ Implemented |
| **Info Disclosure** | IV reuse (breaks GCM) | CRITICAL | Same IV used twice with same key | - Random IV generated per message<br>- Web Crypto API ensures randomness | ✅ Implemented |
| **DoS** | Flood with messages | HIGH | Send millions of messages | - Rate limiting per user<br>- Message size limits<br>- Storage quotas | ⚠️ Basic rate limiting |
| **Elevation** | N/A | N/A | N/A | N/A | N/A |

---

### 4.5 File Encryption & Storage

| Threat Type | Specific Threat | Risk Level | Attack Scenario | Mitigation | Implementation Status |
|-------------|-----------------|------------|-----------------|------------|----------------------|
| **Spoofing** | Upload file as another user | HIGH | Forge uploader ID | - JWT authentication<br>- Server validates uploader ID | ✅ Implemented |
| **Tampering** | Modify encrypted file chunks | HIGH | Alter ciphertext | - Per-chunk AES-GCM auth tags<br>- Decryption fails if tampered | ✅ Implemented |
| **Tampering** | Corrupt file during upload | MEDIUM | Network error | - Chunk-based upload (retry failed chunks)<br>- Auth tag verification | ✅ Implemented |
| **Repudiation** | Deny uploading file | LOW | Claim "I didn't upload that" | - Uploader ID logged<br>- Timestamp recorded | ✅ Implemented |
| **Info Disclosure** | Read files on server | CRITICAL | Malicious server admin | - Client-side encryption before upload<br>- Server stores only ciphertext<br>- No keys on server | ✅ Implemented & Verified |
| **Info Disclosure** | Download unauthorized file | HIGH | Guess file ID and download | - Access control (only uploader + recipient can access)<br>- Server validates user ID against file permissions | ⚠️ Basic (check recipient ID) |
| **DoS** | Upload huge files | HIGH | Exhaust storage | - File size limits<br>- Storage quotas per user<br>- Chunking limits | ⚠️ Basic (file size limits) |
| **DoS** | Delete files | MEDIUM | Unauthorized deletion | - Access control<br>- Only uploader can delete | ⚠️ Basic implementation |
| **Elevation** | N/A | N/A | N/A | N/A | N/A |

---

### 4.6 Server & Database

| Threat Type | Specific Threat | Risk Level | Attack Scenario | Mitigation | Implementation Status |
|-------------|-----------------|------------|-----------------|------------|----------------------|
| **Spoofing** | Rogue server | CRITICAL | Attacker sets up fake server | - HTTPS with valid certificate<br>- User verifies domain | ⚠️ User responsibility |
| **Tampering** | Modify database | HIGH | SQL injection / NoSQL injection | - MongoDB with parameterized queries<br>- Input validation<br>- Least privilege DB user | ✅ Implemented |
| **Tampering** | Modify server code | CRITICAL | Compromise server host | - Server hardening<br>- Regular updates<br>- Access control | ⚠️ Out of scope (deployment security) |
| **Repudiation** | Server denies receiving message | LOW | Lost messages | - Logging all received messages<br>- Client confirmation | ✅ Implemented |
| **Info Disclosure** | Database breach | CRITICAL | Attacker dumps database | - Only ciphertext stored<br>- Password hashes (argon2)<br>- No private keys<br>- No plaintext | ✅ Implemented |
| **Info Disclosure** | Log file disclosure | MEDIUM | Logs contain sensitive data | - Never log plaintext<br>- Never log private keys<br>- Only log metadata | ✅ Verified |
| **DoS** | Server crash | HIGH | Exploit bug to crash Node.js | - Input validation<br>- Error handling<br>- Rate limiting | ⚠️ Basic error handling |
| **DoS** | Resource exhaustion | HIGH | Memory/CPU/disk exhaustion | - Resource limits<br>- Connection limits<br>- Storage quotas | ⚠️ Basic limits |
| **Elevation** | Gain shell access | CRITICAL | RCE vulnerability | - No eval() or unsafe code execution<br>- Input validation<br>- Dependency updates | ✅ Code review performed |

---

### 4.7 Client Browser Storage

| Threat Type | Specific Threat | Risk Level | Attack Scenario | Mitigation | Implementation Status |
|-------------|-----------------|------------|-----------------|------------|----------------------|
| **Spoofing** | XSS attack steals session | HIGH | Inject malicious script | - CSP (Content Security Policy)<br>- Input sanitization<br>- httpOnly cookies (if used) | ⚠️ Basic sanitization |
| **Tampering** | Modify IndexedDB | HIGH | Malware alters stored keys | - Private keys encrypted<br>- Integrity checks on key retrieval | ✅ Implemented |
| **Repudiation** | N/A | N/A | N/A | N/A | N/A |
| **Info Disclosure** | Malware reads IndexedDB | CRITICAL | Keylogger / spyware | - Private keys encrypted (not plaintext)<br>- Requires password to decrypt<br>- User education | ✅ Encrypted keys |
| **Info Disclosure** | Browser extension reads data | HIGH | Malicious extension | - User education (only install trusted extensions)<br>- Browser's extension permissions | ⚠️ User responsibility |
| **DoS** | Clear browser data | MEDIUM | User or malware clears storage | - Warn user about data loss<br>- No automatic recovery (security trade-off) | ✅ Warning shown |
| **Elevation** | N/A | N/A | N/A | N/A | N/A |

---

### 4.8 Network Communication

| Threat Type | Specific Threat | Risk Level | Attack Scenario | Mitigation | Implementation Status |
|-------------|-----------------|------------|-----------------|------------|----------------------|
| **Spoofing** | DNS spoofing | MEDIUM | Redirect to fake server | - HTTPS with certificate validation<br>- HSTS headers | ⚠️ HTTPS only (HSTS optional) |
| **Tampering** | Packet modification | MEDIUM | Modify data in transit | - HTTPS (TLS) protects transport<br>- E2EE protects content | ✅ Implemented |
| **Tampering** | SSL stripping | MEDIUM | Downgrade to HTTP | - Force HTTPS<br>- HSTS | ⚠️ HTTPS only |
| **Repudiation** | N/A | N/A | N/A | N/A | N/A |
| **Info Disclosure** | Packet sniffing | LOW | Capture network traffic | - HTTPS (encrypted transport)<br>- E2EE (encrypted content) | ✅ Implemented |
| **Info Disclosure** | Traffic analysis | MEDIUM | Observe metadata (size, timing) | - HTTPS hides some metadata<br>- Padding (not implemented) | ⚠️ Partial |
| **DoS** | Network flood | HIGH | DDoS attack on server | - Rate limiting<br>- Firewall<br>- CDN (if deployed) | ⚠️ Basic rate limiting |
| **Elevation** | N/A | N/A | N/A | N/A | N/A |

---

## 5. Risk Summary

### Critical Risks (Fully Mitigated)
✅ MITM attack on key exchange → **Signatures**
✅ Server reads messages → **E2EE**
✅ Server reads files → **Client-side encryption**
✅ Database breach reveals plaintext → **Only ciphertext stored**
✅ Private key stored on server → **Never transmitted**

### High Risks (Mitigated)
✅ Replay attacks → **Nonces + timestamps + sequence numbers**
✅ Message tampering → **AES-GCM auth tags**
✅ Weak passwords → **argon2 + rate limiting**
✅ IV reuse → **Random IV per message**

### Medium Risks (Partially Mitigated)
⚠️ Malware on client device → **Encrypted keys, but still vulnerable**
⚠️ DoS attacks → **Basic rate limiting, could be improved**
⚠️ Traffic analysis → **HTTPS helps, but metadata visible to server**

### Low Risks (Accepted)
- Repudiation (E2EE makes forensics harder)
- User education issues (phishing, weak passwords)

---

## 6. Attack Tree

### Goal: Read Alice's Messages

```
Read Alice's Messages
│
├─ Attack Server
│  ├─ Compromise server → ❌ Only ciphertext available
│  ├─ Database breach → ❌ Only ciphertext stored
│  └─ Intercept network → ❌ HTTPS + E2EE
│
├─ Attack Key Exchange
│  ├─ MITM attack → ❌ Signatures prevent
│  ├─ Replay attack → ❌ Nonces prevent
│  └─ Brute force ECDH → ❌ Computationally infeasible
│
├─ Attack Client (Alice)
│  ├─ Steal private key from IndexedDB → ⚠️ Encrypted, need password
│  ├─ Keylogger (steal password) → ✅ POSSIBLE (malware defense out of scope)
│  ├─ XSS attack → ⚠️ Basic defenses, possible
│  └─ Phishing (steal credentials) → ✅ POSSIBLE (user education)
│
└─ Attack Cryptography
   ├─ Break AES-256 → ❌ Computationally infeasible
   ├─ Break ECDH P-256 → ❌ Computationally infeasible (current tech)
   └─ Find implementation bug → ⚠️ Possible (code review performed)
```

**Conclusion:** Most realistic attack vector is **compromising the client device** (malware, phishing). This is out of scope for this project, but acknowledged as a limitation.

---

## 7. Compliance with Security Principles

### CIA Triad

| Principle | Implementation | Status |
|-----------|----------------|--------|
| **Confidentiality** | E2EE (AES-256-GCM), secure key storage, HTTPS | ✅ Strong |
| **Integrity** | AES-GCM auth tags, digital signatures, hash functions | ✅ Strong |
| **Availability** | Basic rate limiting, error handling | ⚠️ Basic |

### Additional Properties

| Property | Implementation | Status |
|----------|----------------|--------|
| **Authentication** | Password + JWT, digital signatures | ✅ Strong |
| **Non-Repudiation** | Digital signatures, logging | ⚠️ Partial (E2EE limits) |
| **Forward Secrecy** | Ephemeral ECDH keys | ✅ Strong |

---

## 8. Recommendations

### Implemented & Working
1. ✅ Use HTTPS exclusively
2. ✅ Implement E2EE with AES-256-GCM
3. ✅ Use strong key sizes (ECC P-256, AES-256)
4. ✅ Never store private keys on server
5. ✅ Use digital signatures for authentication
6. ✅ Implement replay protection (nonce + timestamp + sequence)
7. ✅ Hash passwords with argon2
8. ✅ Log security events (without sensitive data)
9. ✅ Validate all inputs
10. ✅ Use Web Crypto API (not custom crypto)

### Future Improvements (Beyond Scope)
1. ⬜ Add two-factor authentication
2. ⬜ Implement HSTS (HTTP Strict Transport Security)
3. ⬜ Add Content Security Policy headers
4. ⬜ Implement certificate pinning
5. ⬜ Add traffic padding (hide message sizes)
6. ⬜ Implement disappearing messages
7. ⬜ Add perfect forward secrecy for each message (Double Ratchet)
8. ⬜ Implement secure key backup/recovery
9. ⬜ Add multi-device support
10. ⬜ Conduct professional security audit

---

## 9. Conclusion

This threat model demonstrates that the system:
- ✅ **Protects against MITM attacks** (signatures)
- ✅ **Protects against replay attacks** (nonces + timestamps)
- ✅ **Ensures confidentiality** (E2EE, no plaintext on server)
- ✅ **Ensures integrity** (AES-GCM auth tags, signatures)
- ✅ **Provides authentication** (passwords, signatures, JWT)
- ✅ **Achieves forward secrecy** (ephemeral ECDH)

The most significant residual risk is **client-side compromise** (malware, phishing), which is acknowledged as a limitation of any client-side encryption system and is out of scope for this academic project.

---

**Document Version:** 1.0  
**Last Updated:** [Your Date]  
**Authors:** [Your Team Members]

